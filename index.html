<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Image Compressor</title>
<style>
 body { font-family: Arial; max-width: 520px; margin: 40px auto; }
 label { display:block; margin-top:15px; }
 canvas { border:1px solid #ccc; margin-top:15px; }
</style>
</head>
<body>

<h2>Image Resizer & Compressor</h2>

<input type="file" id="upload" accept="image/*">

<label>
 Width (px):
 <input type="number" id="width" value="800">
</label>

<label>
 Compression: <span id="qval">80</span>%
 <input type="range" id="quality" min="10" max="100" value="80">
</label>

<label>
 <input type="checkbox" id="crop"> Enable Center Crop
</label>

<p>
 Expected size: <strong><span id="size">--</span></strong>
</p>

<button onclick="processImage()">Process</button>

<br><br>
<canvas id="canvas"></canvas>

<br><br>
<a id="download" style="display:none;">Download Image</a>

<script>
let originalImg, origW, origH;

upload.onchange = () => {
  originalImg = new Image();
  originalImg.onload = () => {
    origW = originalImg.width;
    origH = originalImg.height;
    processImage();
  };
  originalImg.src = URL.createObjectURL(upload.files[0]);
};

quality.oninput = () => {
  qval.textContent = quality.value;
  processImage();
};

width.oninput = processImage;
crop.onchange = processImage;

function processImage() {
  if (!originalImg) return;

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const newW = parseInt(width.value);
  const ratio = origH / origW;
  const newH = Math.round(newW * ratio);

  canvas.width = newW;
  canvas.height = newH;

  let sx=0, sy=0, sw=origW, sh=origH;

  if (crop.checked) {
    const min = Math.min(origW, origH);
    sx = (origW - min) / 2;
    sy = (origH - min) / 2;
    sw = sh = min;
  }

  ctx.drawImage(originalImg, sx, sy, sw, sh, 0, 0, newW, newH);

  const q = quality.value / 100;
  const dataURL = canvas.toDataURL("image/jpeg", q);

 canvas.toBlob(blob => {
  const kb = Math.round(blob.size / 1024);
  size.textContent = kb + " KB";
}, "image/jpeg", q);


  download.href = dataURL;
  download.download = "compressed.jpg";
  download.style.display = "inline-block";
  download.textContent = "Download Image";
}
</script>

</body>
</html>

