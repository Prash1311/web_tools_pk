<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Compressor</title>
<style>
 body { font-family: Arial; max-width:520px; margin:40px auto; }
 label { display:block; margin-top:15px; }
 canvas { border:1px solid #ccc; margin-top:15px; }
</style>
</head>
<body>

<h2>Image Resizer & Compressor</h2>

<input type="file" id="upload" accept="image/*">

<label>
 Width (px):
 <input type="number" id="width" value="800">
</label>

<label>
 Compression: <span id="qval">80</span>%
 <input type="range" id="quality" min="10" max="100" value="80">
</label>

<label>
 <input type="checkbox" id="crop"> Enable Center Crop
</label>

<p>
 Original size: <strong><span id="origSize">--</span></strong><br>
 Expected size: <strong><span id="estSize">--</span></strong>
</p>

<button onclick="processImage()">Process</button>

<canvas id="canvas"></canvas><br><br>
<a id="download" style="display:none;">Download Image</a>

<script>
let img, origW, origH, originalBytes = 0;

upload.onchange = () => {
  const file = upload.files[0];
  if (!file) return;

  originalBytes = file.size;
  origSize.textContent = Math.round(originalBytes / 1024) + " KB";

  img = new Image();
  img.onload = processImage;
  img.src = URL.createObjectURL(file);
};

quality.oninput = () => {
  qval.textContent = quality.value;
  estimateSize();
};

width.oninput = estimateSize;
crop.onchange = estimateSize;

function estimateSize() {
  if (!originalBytes) return;

  const q = quality.value / 100;
  const scale = width.value / (origW || width.value);

  // rough but stable estimation
  const estimated = originalBytes * q * scale * scale;
  estSize.textContent = Math.max(1, Math.round(estimated / 1024)) + " KB";
}

function processImage() {
  if (!img) return;

  origW = img.width;
  origH = img.height;

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const newW = parseInt(width.value);
  const newH = Math.round(newW * (origH / origW));

  canvas.width = newW;
  canvas.height = newH;

  let sx=0, sy=0, sw=origW, sh=origH;
  if (crop.checked) {
    const m = Math.min(origW, origH);
    sx = (origW - m) / 2;
    sy = (origH - m) / 2;
    sw = sh = m;
  }

  ctx.drawImage(img, sx, sy, sw, sh, 0, 0, newW, newH);

  const q = quality.value / 100;
  const dataURL = canvas.toDataURL("image/jpeg", q);

  download.href = dataURL;
  download.download = "compressed.jpg";
  download.style.display = "inline-block";
  download.textContent = "Download Image";

  estimateSize();
}
</script>

</body>
</html>
