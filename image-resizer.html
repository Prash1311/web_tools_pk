<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Resizer</title>

<style>
  .donate-float {
  position:fixed;
  top:10px;
  right:10px;
  z-index:2000;
}

.donate-float button {
  background:#ff813f;
  color:#fff;
  border:none;
  border-radius:50%;
  width:44px;
  height:44px;
  font-size:20px;
  cursor:pointer;
}

.qr-box {
  position:absolute;
  top:50px;
  right:0;
  background:#fff;
  padding:10px;
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
  display:none;
}

.qr-box img {
  width:160px;
}

.note {
  font-size:11px;
  text-align:center;
  margin-top:5px;
  color:#555;
}

/* ---------- Navigation ---------- */
.nav {
  background:#222;
  padding:12px 0;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:24px;
}

.nav a {
  color:#fff;
  text-decoration:none;
  font-weight:bold;
}

.nav a:hover {
  text-decoration:underline;
}

/* ---------- Page ---------- */
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
}

.container {
  max-width:700px;
  margin:20px auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,0.15);
}

label {
  display:block;
  margin-top:12px;
}

.frame {
  width:600px;
  height:400px;
  border:1px solid #333;
  margin-top:15px;
  position:relative;
}

canvas {
  width:100%;
  height:100%;
  cursor:crosshair;
}

#download {
  position:absolute;
  top:8px;
  right:8px;
  background:#0d6efd;
  color:#fff;
  padding:6px 10px;
  text-decoration:none;
  display:none;
  border-radius:4px;
  font-size:14px;
}

button {
  margin-top:15px;
  padding:10px;
  border:none;
  border-radius:6px;
  background:#0d6efd;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="donate-float">
  <button onclick="toggleQR()">‚òï</button>
  <div class="qr-box" id="qr">
    <img src="qr.jpg" alt="Donate QR">
    <div class="note">Voluntary support ‚ù§Ô∏è</div>
  </div>
</div>

<!-- Navigation (no self link) -->
<nav class="nav">
  <a href="index.html">üè† Home</a>
  <a href="pdf-resizer.html">üìÑ PDF Resizer</a>
  <a href="certificate.html">üéì Certificate</a>
</nav>

<div class="container">
<h2>Image Resizer & Compressor</h2>

<input type="file" id="upload" accept="image/*">

<label>
 Output width (px):
 <input type="number" id="outWidth" value="800">
</label>

<label>
 Compression: <span id="qv">80</span>%
 <input type="range" id="quality" min="10" max="100" value="80">
</label>

<p>
 Original size: <b><span id="origSize">--</span></b><br>
 Estimated size: <b><span id="estSize">--</span></b>
</p>

<div class="frame">
  <a id="download">Download</a>
  <canvas id="canvas" width="600" height="400"></canvas>
</div>

<p><small>Drag inside image to select crop area</small></p>

<button onclick="process()">Process Image</button>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let img, fileBytes;
let fit = {};
let drag=false, sx, sy, ex, ey;
let cropRatio = 1;

upload.onchange = () => {
  const file = upload.files[0];
  if (!file) return;

  fileBytes = file.size;
  origSize.textContent = Math.round(fileBytes/1024)+" KB";

  img = new Image();
  img.onload = () => {
    drawThumbnail();
    estimate();
  };
  img.src = URL.createObjectURL(file);
};

function drawThumbnail(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const scale = Math.min(
    canvas.width / img.width,
    canvas.height / img.height
  );

  fit.w = img.width * scale;
  fit.h = img.height * scale;
  fit.x = (canvas.width - fit.w) / 2;
  fit.y = (canvas.height - fit.h) / 2;

  ctx.drawImage(img, fit.x, fit.y, fit.w, fit.h);
}

quality.oninput = () => {
  qv.textContent = quality.value;
  estimate();
};

outWidth.oninput = estimate;

function estimate(){
  if(!img || !fileBytes) return;

  const q = quality.value / 100;
  const scale = outWidth.value / img.width;

  if (!isFinite(cropRatio) || cropRatio <= 0) cropRatio = 1;

  const est = fileBytes * cropRatio * q * scale * scale;
  estSize.textContent = Math.max(1,Math.round(est/1024))+" KB";
}

/* -------- Crop selection -------- */
canvas.onmousedown = e => {
  if(!inside(e.offsetX,e.offsetY)) return;
  drag=true;
  sx=e.offsetX; sy=e.offsetY;
};

canvas.onmousemove = e => {
  if(!drag) return;
  ex=e.offsetX; ey=e.offsetY;
  drawThumbnail();
  ctx.strokeStyle="red";
  ctx.strokeRect(sx,sy,ex-sx,ey-sy);
};

canvas.onmouseup = () => {
  drag=false;
  updateCropRatio();
};

function inside(x,y){
  return (
    x>=fit.x && x<=fit.x+fit.w &&
    y>=fit.y && y<=fit.y+fit.h
  );
}

function updateCropRatio(){
  if(!sx || !ex) {
    cropRatio = 1;
    estimate();
    return;
  }

  const rx = (Math.min(sx,ex)-fit.x)/fit.w;
  const ry = (Math.min(sy,ey)-fit.y)/fit.h;
  const rw = Math.abs(ex-sx)/fit.w;
  const rh = Math.abs(ey-sy)/fit.h;

  if(rw<=0 || rh<=0){
    cropRatio = 1;
  } else {
    cropRatio = (rw*rh);
  }
  estimate();
}
/* -------------------------------- */

function process(){
  if(!img) return alert("Select an image");

  if(!sx || !ex){
    alert("Please select crop area");
    return;
  }

  const rx = (Math.min(sx,ex)-fit.x)/fit.w;
  const ry = (Math.min(sy,ey)-fit.y)/fit.h;
  const rw = Math.abs(ex-sx)/fit.w;
  const rh = Math.abs(ey-sy)/fit.h;

  const cx = rx * img.width;
  const cy = ry * img.height;
  const cw = rw * img.width;
  const ch = rh * img.height;

  const ratio = ch/cw;
  const newW = outWidth.value;
  const newH = Math.round(newW*ratio);

  const out = document.createElement("canvas");
  out.width=newW;
  out.height=newH;

  out.getContext("2d").drawImage(
    img, cx, cy, cw, ch, 0,0,newW,newH
  );

  const data = out.toDataURL("image/jpeg",quality.value/100);
  download.href=data;
  download.download="compressed.jpg";
  download.style.display="block";
}
</script>

  <script>
function toggleQR(){
  const qr = document.getElementById("qr");
  qr.style.display = (qr.style.display === "block") ? "none" : "block";
}
</script>

</body>
</html>


