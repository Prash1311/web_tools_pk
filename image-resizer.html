<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Image Resizer & Compressor</title>
<style>
 <nav class="nav">
  <a href="index.html">ğŸ  Home</a>
  <a href="image-resizer.html">ğŸ–¼ Image Resizer</a>
  <a href="pdf-resizer.html">ğŸ“„ PDF Resizer</a>
  <a href="certificate.html">ğŸ“ Certificate</a>
</nav>

 body { font-family: Arial; max-width:700px; margin:20px auto; }
 .frame {
   width:600px; height:400px;
   border:1px solid #333;
   position:relative;
   margin-top:10px;
 }
 canvas { width:100%; height:100%; cursor:crosshair; }
 #download {
   position:absolute; top:8px; right:8px;
   background:#0a58ca; color:#fff;
   padding:6px 10px; text-decoration:none;
   display:none; font-size:14px;
 }
 label { display:block; margin-top:10px; }
</style>
</head>
 
<body>
 <nav class="nav">
  <a href="index.html">ğŸ  Home</a>
  <a href="image-resizer.html">ğŸ–¼ Image Resizer</a>
  <a href="pdf-resizer.html">ğŸ“„ PDF Resizer</a>
  <a href="certificate.html">ğŸ“ Certificate</a>
</nav>


<h3>Image Resizer & Compressor</h3>

<input type="file" id="upload" accept="image/*">

<label>
 Output width (px):
 <input type="number" id="outWidth" value="800">
</label>

<label>
 Compression: <span id="qv">80</span>%
 <input type="range" id="quality" min="10" max="100" value="80">
</label>

<p>
 Original: <b><span id="origSize">--</span></b> |
 Estimated: <b><span id="estSize">--</span></b>
</p>

<div class="frame">
  <a id="download">Download</a>
  <canvas id="canvas" width="600" height="400"></canvas>
</div>

<p><small>Drag inside image to crop</small></p>

<button onclick="process()">Process</button>

<script>
 let cropRatio = 1;   // fraction of image kept after crop

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let img, fileBytes;
let fit = {}; // fitted image box
let drag=false, sx, sy, ex, ey;

upload.onchange = () => {
  const file = upload.files[0];
  fileBytes = file.size;
  origSize.textContent = Math.round(fileBytes/1024)+" KB";

  img = new Image();
  img.onload = () => {
    drawThumbnail();
    estimate();
  };
  img.src = URL.createObjectURL(file);
};

function drawThumbnail(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const scale = Math.min(
    canvas.width / img.width,
    canvas.height / img.height
  );

  fit.w = img.width * scale;
  fit.h = img.height * scale;
  fit.x = (canvas.width - fit.w) / 2;
  fit.y = (canvas.height - fit.h) / 2;

  ctx.drawImage(img, fit.x, fit.y, fit.w, fit.h);
}

quality.oninput = () => {
  qv.textContent = quality.value;
  estimate();
};
outWidth.oninput = estimate;

function estimate(){
  if(!img) return;

  const q = quality.value / 100;
  const scale = outWidth.value / img.width;

  const est =
    fileBytes *
    cropRatio *
    q *
    scale *
    scale;

  estSize.textContent =
    Math.max(1, Math.round(est / 1024)) + " KB";
}


/* ---- crop selector inside fitted image ---- */
canvas.onmousedown = e => {
  if(!inside(e.offsetX,e.offsetY)) return;
  drag=true;
  sx=e.offsetX; sy=e.offsetY;
};

canvas.onmousemove = e => {
  if(!drag) return;
  ex=e.offsetX; ey=e.offsetY;
  drawThumbnail();
  ctx.strokeStyle="red";
  ctx.strokeRect(sx,sy,ex-sx,ey-sy);
};

canvas.onmouseup = () => drag=false;

function inside(x,y){
  return (
    x>=fit.x && x<=fit.x+fit.w &&
    y>=fit.y && y<=fit.y+fit.h
  );
}
/* ------------------------------------------ */

function process(){
  if(!img || !sx || !ex) return alert("Select crop area");

  const rx = (Math.min(sx,ex)-fit.x)/fit.w;
  const ry = (Math.min(sy,ey)-fit.y)/fit.h;
  const rw = Math.abs(ex-sx)/fit.w;
  const rh = Math.abs(ey-sy)/fit.h;

  const cx = rx * img.width;
  const cy = ry * img.height;
  const cw = rw * img.width;
  const ch = rh * img.height;

 const originalArea = img.width * img.height;
const croppedArea = cw * ch;
cropRatio = croppedArea / originalArea;

estimate();   // update size after crop


  const ratio = ch/cw;
  const newW = outWidth.value;
  const newH = Math.round(newW*ratio);

  const out = document.createElement("canvas");
  out.width=newW; out.height=newH;
  out.getContext("2d").drawImage(
    img, cx, cy, cw, ch, 0,0,newW,newH
  );

  const data = out.toDataURL("image/jpeg",quality.value/100);
  download.href=data;
  download.download="compressed.jpg";
  download.style.display="block";
}
</script>

</body>
</html>


