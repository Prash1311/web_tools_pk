<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Certificate Generator (Word)</title>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.umd.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
}

.nav {
  background:#222;
  padding:12px;
  text-align:center;
}

.nav a {
  color:#fff;
  margin:0 12px;
  text-decoration:none;
  font-weight:bold;
}

.container {
  max-width:900px;
  margin:30px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,0.15);
}

button {
  padding:10px 16px;
  border:none;
  border-radius:6px;
  background:#2d7ff9;
  color:#fff;
  cursor:pointer;
  margin-top:10px;
}
</style>
</head>

<body>

<nav class="nav">
  <a href="index.html">üè† Home</a>
  <a href="image-resizer.html">üñº Image Resizer</a>
  <a href="pdf-resizer.html">üìÑ PDF Resizer</a>
</nav>

<div class="container">
  <h2>Certificate Generator (Single Word File)</h2>

  <input type="file" id="file" accept=".xlsx"><br><br>
  <button id="btnGenerate">Generate Word Certificate</button>
</div>

<script>
const { Document, Packer, Paragraph, TextRun, PageBreak, AlignmentType } = window.docx;

document.getElementById("btnGenerate").addEventListener("click", generateWord);

function generateWord() {
  const file = document.getElementById("file").files[0];
  if (!file) {
    alert("Please upload Excel (.xlsx)");
    return;
  }

  const reader = new FileReader();
  reader.onload = e => {
    const wb = XLSX.read(new Uint8Array(e.target.result), { type: "array" });
    const sheet = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet);

    if (!rows.length) {
      alert("Excel file is empty");
      return;
    }

    const children = [];

    rows.forEach((r, index) => {
      const nameHI = r.name_hi && r.name_hi.trim() ? r.name_hi : r.name_en;

      children.push(
        new Paragraph({
          text: "KENDRIYA VIDYALAYA SANGATHAN, NEW DELHI",
          alignment: AlignmentType.CENTER,
          spacing: { after: 300 },
          bold: true,
        }),

        new Paragraph({
          text: "‡§™‡•ç‡§∞‡§Æ‡§æ‡§£-‡§™‡§§‡•ç‡§∞",
          alignment: AlignmentType.CENTER,
          spacing: { after: 500 },
        }),

        new Paragraph({
          children: [
            new TextRun(`‡§Ø‡§π ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä/‡§°‡•â. ${nameHI}`)
          ],
          spacing: { after: 300 },
        }),

        new Paragraph({
          children: [
            new TextRun(`${r.start_date} ‡§∏‡•á ${r.end_date} ‡§§‡§ï`)
          ],
          spacing: { after: 300 },
        }),

        new Paragraph({
          children: [
            new TextRun(`${r.hours} ‡§ò‡§Ç‡§ü‡•á ‡§π‡•á‡§§‡•Å`)
          ],
          spacing: { after: 500 },
        }),

        new Paragraph({
          children: [
            new TextRun(`This is to certify that ${r.name_en}`)
          ],
          spacing: { after: 200 },
        }),

        new Paragraph({
          children: [
            new TextRun(
              `has attended training from ${r.start_date} to ${r.end_date} for ${r.hours} hours.`
            )
          ],
          spacing: { after: 800 },
        }),

        new Paragraph({
          text: "Principal",
          alignment: AlignmentType.RIGHT,
        })
      );

      // Page break between certificates
      if (index < rows.length - 1) {
        children.push(new Paragraph({ children: [new PageBreak()] }));
      }
    });

    const doc = new Document({
      sections: [
        {
          properties: {},
          children: children,
        },
      ],
    });

    Packer.toBlob(doc).then(blob => {
      saveAs(blob, "certificates.docx");
    });
  };

  reader.readAsArrayBuffer(file);
}
</script>

</body>
</html>
