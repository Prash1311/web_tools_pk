<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Certificate Generator (Word)</title>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
}

.nav {
  background:#222;
  padding:12px;
  text-align:center;
}

.nav a {
  color:#fff;
  margin:0 12px;
  text-decoration:none;
  font-weight:bold;
}

.container {
  max-width:900px;
  margin:30px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,0.15);
}

button {
  padding:10px 16px;
  border:none;
  border-radius:6px;
  background:#2d7ff9;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<nav class="nav">
  <a href="index.html">üè† Home</a>
  <a href="image-resizer.html">üñº Image Resizer</a>
  <a href="pdf-resizer.html">üìÑ PDF Resizer</a>
</nav>

<div class="container">
  <h2>Certificate Generator (Single Word File)</h2>

  <input type="file" id="file" accept=".xlsx"><br><br>
  <button id="btnGenerate">Generate Word Certificate</button>
</div>

<script>
  const {
  Document,
  Packer,
  Paragraph,
  TextRun,
  PageBreak,
  AlignmentType
} = window.docx;


document.getElementById("btnGenerate").addEventListener("click", generateWord);

function excelDateToString(excelDate) {
  if (typeof excelDate === "number") {
    const date = new Date((excelDate - 25569) * 86400 * 1000);
    return date.toLocaleDateString("en-GB"); // dd/mm/yyyy
  }
  return excelDate; // already text
}

function generateWord() {
  const file = document.getElementById("file").files[0];
  if (!file) {
    alert("Please upload Excel (.xlsx)");
    return;
  }

  const reader = new FileReader();
  reader.onload = e => {
    const wb = XLSX.read(new Uint8Array(e.target.result), { type: "array" });
    const sheet = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet);

    if (!rows.length) {
      alert("Excel file is empty");
      return;
    }

    const {
      Document,
      Packer,
      Paragraph,
      TextRun,
      PageBreak,
      AlignmentType,
      PageOrientation
    } = window.docx;

    const children = [];

    rows.forEach((r, index) => {
      const nameHI = r.name_hi && r.name_hi.trim()
        ? r.name_hi
        : r.name_en;

      const startDate = excelDateToString(r.start_date);
      const endDate = excelDateToString(r.end_date);

      // ---------- HEADER ----------
      children.push(
        new Paragraph({
          alignment: AlignmentType.CENTER,
          spacing: { before: 500 },
          children: [
            new TextRun({
              text: "KENDRIYA VIDYALAYA SANGATHAN, NEW DELHI",
              bold: true,
              size: 32 // 16pt
            })
          ]
        })
      );

      children.push(
        new Paragraph({
          alignment: AlignmentType.CENTER,
          spacing: { after: 600 },
          children: [
            new TextRun({
              text: "‡§™‡•ç‡§∞‡§Æ‡§æ‡§£-‡§™‡§§‡•ç‡§∞",
              bold: true,
              size: 28 // 14pt
            })
          ]
        })
      );

      // ---------- HINDI BODY ----------
      children.push(
        new Paragraph({
          spacing: { after: 300 },
          children: [
            new TextRun({
              text: `‡§Ø‡§π ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§∂‡•ç‡§∞‡•Ä/‡§∂‡•ç‡§∞‡•Ä‡§Æ‡§§‡•Ä/‡§∏‡•Å‡§∂‡•ç‡§∞‡•Ä/‡§°‡•â. ${nameHI}`,
              size: 24
            })
          ]
        })
      );

      children.push(
        new Paragraph({
          spacing: { after: 300 },
          children: [
            new TextRun({
              text: `${startDate} ‡§∏‡•á ${endDate} ‡§§‡§ï`,
              size: 24
            })
          ]
        })
      );

      children.push(
        new Paragraph({
          spacing: { after: 600 },
          children: [
            new TextRun({
              text: `${r.hours} ‡§ò‡§Ç‡§ü‡•á ‡§π‡•á‡§§‡•Å`,
              size: 24
            })
          ]
        })
      );

      // ---------- ENGLISH BODY ----------
      children.push(
        new Paragraph({
          spacing: { after: 200 },
          children: [
            new TextRun({
              text: `This is to certify that ${r.name_en}`,
              size: 24
            })
          ]
        })
      );

      children.push(
        new Paragraph({
          spacing: { after: 800 },
          children: [
            new TextRun({
              text: `has attended training from ${startDate} to ${endDate} for ${r.hours} hours.`,
              size: 24
            })
          ]
        })
      );

      // ---------- FOOTER ----------
      children.push(
        new Paragraph({
          alignment: AlignmentType.RIGHT,
          spacing: { before: 400 },
          children: [
            new TextRun({
              text: "Principal",
              size: 24
            })
          ]
        })
      );

      // ---------- PAGE BREAK ----------
      if (index < rows.length - 1) {
        children.push(new Paragraph({ children: [new PageBreak()] }));
      }
    });

    const doc = new Document({
      sections: [
        {
          properties: {
            page: {
              size: {
                orientation: PageOrientation.LANDSCAPE
              },
              margin: {
                top: 720,
                bottom: 720,
                left: 720,
                right: 720
              }
            }
          },
          children: children
        }
      ]
    });

    Packer.toBlob(doc).then(blob => {
      saveAs(blob, "certificates.docx");
    });
  };

  reader.readAsArrayBuffer(file);
}


</script>

</body>
</html>
