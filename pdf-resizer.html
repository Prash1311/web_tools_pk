<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDF Resizer</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

<style>
/* ---------- Navigation ---------- */
.nav {
  background:#222;
  padding:12px 0;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:24px;
}

.nav a {
  color:#fff;
  text-decoration:none;
  font-weight:bold;
}

.nav a:hover {
  text-decoration:underline;
}

/* ---------- Donate Floating ---------- */
.donate-float {
  position:fixed;
  top:10px;
  right:10px;
  z-index:2000;
}

.donate-float button {
  background:#ff813f;
  color:#fff;
  border:none;
  border-radius:50%;
  width:44px;
  height:44px;
  font-size:20px;
  cursor:pointer;
}

.qr-box {
  position:absolute;
  top:50px;
  right:0;
  background:#fff;
  padding:10px;
  border-radius:8px;
  box-shadow:0 4px 12px rgba(0,0,0,0.2);
  display:none;
}

.qr-box img {
  width:160px;
}

.note {
  font-size:11px;
  text-align:center;
  margin-top:5px;
  color:#555;
}

/* ---------- Page ---------- */
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
}

.container {
  max-width:600px;
  margin:30px auto;
  background:#fff;
  padding:25px;
  border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,0.15);
}

label {
  display:block;
  margin-top:15px;
}

button.main {
  margin-top:20px;
  padding:12px;
  width:100%;
  border:none;
  border-radius:6px;
  background:#198754;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- Buy Me a Coffee (Top Right) -->
<div class="donate-float">
  <button onclick="toggleQR()">‚òï</button>
  <div class="qr-box" id="qr">
    <img src="qr.jpg" alt="Donate QR">
    <div class="note">Voluntary support ‚ù§Ô∏è</div>
  </div>
</div>

<!-- Navigation (NO self link) -->
<nav class="nav">
  <a href="index.html">üè† Home</a>
  <a href="image-resizer.html">üñº Image Resizer</a>
  <a href="certificate.html">üéì Certificate</a>
</nav>

<div class="container">
<h2>PDF Resizer</h2>

<input type="file" id="pdfFile" accept="application/pdf">

<label>
 Scale pages (%):
 <input type="range" id="scale" min="50" max="100" value="80">
 <span id="sval">80</span>%
</label>

<p>
 Original size: <b><span id="orig">--</span></b><br>
 Estimated size: <b><span id="est">--</span></b>
</p>

<button class="main" onclick="resizePDF()">Resize & Download</button>
</div>

<script>
/* ---------- Donate ---------- */
function toggleQR(){
  const q = document.getElementById("qr");
  q.style.display = q.style.display === "block" ? "none" : "block";
}

/* ---------- PDF Logic ---------- */
const scaleSlider = document.getElementById("scale");
const sval = document.getElementById("sval");
const orig = document.getElementById("orig");
const est = document.getElementById("est");

let originalBytes = 0;

scaleSlider.oninput = () => {
  sval.textContent = scaleSlider.value;
  estimate();
};

pdfFile.onchange = () => {
  const file = pdfFile.files[0];
  if (!file) return;
  originalBytes = file.size;
  orig.textContent = Math.round(originalBytes/1024)+" KB";
  estimate();
};

function estimate(){
  if (!originalBytes) return;
  const s = scaleSlider.value / 100;
  const estimated = originalBytes * s * s;
  est.textContent = Math.max(1,Math.round(estimated/1024))+" KB";
}

async function resizePDF(){
  const file = pdfFile.files[0];
  if (!file) return alert("Select a PDF");

  const bytes = await file.arrayBuffer();
  const srcPdf = await PDFLib.PDFDocument.load(bytes);
  const outPdf = await PDFLib.PDFDocument.create();

  const scale = scaleSlider.value / 100;
  const pages = srcPdf.getPages();

  for (const page of pages) {
    const { width, height } = page.getSize();
    const newPage = outPdf.addPage([width, height]);

    const [embedded] = await outPdf.embedPages([page]);

    const newW = width * scale;
    const newH = height * scale;
    const x = (width - newW) / 2;
    const y = (height - newH) / 2;

    newPage.drawPage(embedded, {
      x, y, width:newW, height:newH
    });
  }

  const outBytes = await outPdf.save();
  const blob = new Blob([outBytes], { type:"application/pdf" });

  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "resized.pdf";
  link.click();
}
</script>

</body>
</html>
